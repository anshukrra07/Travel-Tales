<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Popup with Zoom & Drag</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f0f0f0;
    }

    img.thumbnail {
      width: 300px;
      cursor: pointer;
      transition: 0.3s;
    }

    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .popup-content {
      position: relative;
      overflow: hidden;
      max-width: 90vw;
      max-height: 90vh;
    }

    .popup img {
      max-width: none;
      transform-origin: top left;
      cursor: grab;
      user-select: none;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 22px;
      color: white;
      background: #000;
      padding: 5px 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>Click the image below:</h2>
  <img src="preview.jpg" alt="Cat" class="thumbnail" id="mainImage">

  <div class="popup" id="popup">
    <div class="popup-content" id="popupContent">
      <span class="close-btn" id="closeBtn">&times;</span>
      <img src="preview.jpg" alt="Zoomable" id="popupImage">
    </div>
  </div>

<script>
  const popup = document.getElementById("popup");
  const mainImage = document.getElementById("mainImage");
  const closeBtn = document.getElementById("closeBtn");
  const popupImage = document.getElementById("popupImage");

  let scale = 1;
  let offsetX = 0;
  let offsetY = 0;
  let isDragging = false;
  let lastX, lastY;

  mainImage.addEventListener("click", () => {
    popup.style.display = "flex";
    scale = 1;
    offsetX = offsetY = 0;
    updateTransform();
  });

  closeBtn.addEventListener("click", () => {
    popup.style.display = "none";
  });

  function updateTransform() {
    popupImage.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
  }

  popupImage.addEventListener("wheel", (e) => {
    e.preventDefault();
    const rect = popupImage.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    const prevScale = scale;

    // Zoom sensitivity: smaller delta = smoother zoom
    const zoomFactor = 0.1;
    const direction = e.deltaY > 0 ? -1 : 1;
    scale += direction * zoomFactor * scale;

    // Clamp the scale value between 1 and 3
    scale = Math.min(Math.max(scale, 1), 3);

    // Adjust offset to zoom towards cursor
    offsetX -= (mouseX / prevScale - mouseX / scale);
    offsetY -= (mouseY / prevScale - mouseY / scale);

    updateTransform();
  });

  popupImage.addEventListener("mousedown", (e) => {
    e.preventDefault();
    isDragging = true;
    lastX = e.clientX;
    lastY = e.clientY;
    popupImage.style.cursor = "grabbing";
  });

  window.addEventListener("mousemove", (e) => {
    if (!isDragging) return;
    offsetX += e.clientX - lastX;
    offsetY += e.clientY - lastY;
    lastX = e.clientX;
    lastY = e.clientY;
    updateTransform();
  });

  window.addEventListener("mouseup", () => {
    isDragging = false;
    popupImage.style.cursor = "grab";
  });
</script>

</body>
</html>